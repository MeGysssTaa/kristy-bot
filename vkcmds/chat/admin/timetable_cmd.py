import ranks
from vkcommands import VKCommand


# TODO !!! –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É (–Ω–∞ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã) !!!
# TODO !!! –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É (–Ω–∞ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã) !!!
# TODO !!! –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É (–Ω–∞ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã) !!!
class TimetableCommand(VKCommand):
    def __init__(self, kristy):
        VKCommand.__init__(self, kristy,
                           label='—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ',
                           desc='–ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º (–Ω–æ–≤–∞—è —Å—Å—ã–ª–∫–∞, –≤—ã–≤–æ–¥ —Ç–µ–∫—É—â–µ–π, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞)',
                           usage='!—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ [—Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–æ–≤—ã–π —Ñ–∞–π–ª | "–æ–±–Ω–æ–≤–∏—Ç—å"]',
                           min_rank=ranks.Rank.ADMIN)

    def execute(self, chat, peer, sender, args=None, attachments=None, fwd_messages=None):
        if args:
            new_url = args[0]

            if new_url.lower() == '–æ–±–Ω–æ–≤–∏—Ç—å':
                # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ —Ç–µ–∫—É—â–µ–π —Å—Å—ã–ª–∫–µ.
                self.kristy.send(peer, '‚åõ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±–µ—Å–µ–¥—ã')
                self.kristy.tt_data.load_timetable(chat)
            else:
                # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É.
                if new_url.startswith('http://') or new_url.startswith('https://'):
                    # –í—Å—ë –≤—ã–≥–ª—è–¥–∏—Ç –û–ö. –ü–æ–ø—ã—Ç–∞–µ–º—Å—è —Å—Ä–∞–∑—É –∂–µ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.
                    self.kristy.db.set_timetable_url(chat, new_url)
                    self.kristy.send(peer, '‚úî –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–∏–ª–∞ —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –±–µ—Å–µ–¥—ã')
                    self.kristy.send(peer, '‚åõ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±–µ—Å–µ–¥—ã')
                    self.kristy.tt_data.load_timetable(chat)
                else:
                    self.kristy.send(peer, '‚ö† –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Å—Å—ã–ª–∫–∏. '
                                           '–í –Ω–∞—á–∞–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "http://" –∏–ª–∏ "https://". \n\n'
                                           'üí° –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏) —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ '
                                           '"!—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ–±–Ω–æ–≤–∏—Ç—å".')
        else:
            # –í—ã–≤–æ–¥–∏–º —Ç–µ–∫—É—â—É—é —Å—Å—ã–ª–∫—É.
            cur_url = self.kristy.db.get_timetable_url(chat)

            if cur_url:
                self.kristy.send(peer, 'üåê –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º: ' + cur_url)
            else:
                self.kristy.send(peer, '‚ùå –§–∞–π–ª —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –¥–ª—è —ç—Ç–æ–π –±–µ—Å–µ–¥—ã –Ω–µ —É–∫–∞–∑–∞–Ω. '
                                       '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "!—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –°–°–´–õ–ö–ê_–ù–ê_–§–ê–ô–õ", —á—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ.')
